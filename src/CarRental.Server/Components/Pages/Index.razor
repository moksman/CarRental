@page "/"

@using CarRental.Application.UseCases.City.Get
@using Microsoft.FluentUI.AspNetCore.Components
@rendermode InteractiveServer
@* @attribute [StreamRendering] *@
@inject NavigationManager NavigationManager
@inject IMediator Mediator

<PageTitle>Home</PageTitle>

<div class="container-fluid hero">
    <div>
        <h1>My awesome website</h1>
        <h2>Look at this website and bask in its amazing glory!</h2>
        <div>
            <FluentAutocomplete 
                TOption="City<int>"
                OnOptionsSearch="@OnSearchAsync"
                OptionText="@(item => item.Name)"
                @bind-SelectedOptions="@cities"  />

            <Button Class="btn btn-dark m-1" @onclick="@(() => NavigationManager.NavigateTo($"car/cz/{string.Join(",", cities.Select(c => c.Id))}"))">Search</Button>
        </div>
   
    </div>
</div>


<style>
    .control-wrapper {
        margin: 30px 40px;
    }

    .example-label {
        font-size: 14px;
        margin-bottom: 6px;
    }
</style>

@code {


    public string CityName { get; set; }
    public City<int> currentCity;

    public IEnumerable<City<int>> cities;
    IEnumerable<City<int>> SelectedItems = Array.Empty<City<int>>();

    private async Task OnSearchAsync(OptionsSearchEventArgs<City<int>> e)
    {
        var cities = await Mediator.Send(new GetAllCityQuery<int>());

        e.Items = cities.Where(i => i.Name.StartsWith(e.Text, StringComparison.OrdinalIgnoreCase))
                              .OrderBy(i => i.Name);

        await Task.CompletedTask;
    }

    



    // protected override async Task OnInitializedAsync()
    // {
    //  if (cities is null) 
    //      cities = await Mediator.Send(new GetAllCityQuery<int>()); 

    // }

}
